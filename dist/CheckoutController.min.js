angular.module("flowerStore").controller("CheckoutController",function(t,n,e,c,r){var a=this;a.step=0,a.params.contact={name:null,province:null,city:null,postal_code:null,address:null,phone:null},a.params.card={number:null,cvc:null,exp_month:null,exp_year:null},c.fetchInProgress(),r.fetchFlowers().then(function(t){a.the_flowers={},angular.forEach(t.flowers,function(t,n){a.the_flowers[t.id]={name:t.name,description:t.description,price:t.price,image:t.image,remaining:t.remaining}})},function(t){}),a.getCards(),a.getContacts(),a.incrementItem=function(n){t.cart[n].quantity<a.the_flowers[n].remaining&&t.cart[n].quantity++},a.decrementItem=function(n){t.cart[n].quantity>0&&t.cart[n].quantity--},a.getTotal=function(){var n=0;for(var e in t.cart)n=t.cart[e].cost;return n},a.removeItem=function(n){c.removeFromCart(t.cart[n].orders_flowers_id).then(function(e){delete t.cart[n]},function(t){})},a.proceedToCards=function(){var n={};angular.forEach(t.cart,function(t,e){n[t.orders_flowers_id]=t.quantity}),c.updateCart(n).then(function(t){a.step=1},function(t){})},a.getCards=function(){UserService.getCards().then(function(t){a.the_cards=t.cards},function(t){})},a.addCard=function(){UserService.addCard(a.params.card).then(function(t){a.the_cards.push(t.the_card),a.chosen_card=Object.assign({},t.the_card)},function(t){})},a.getContacts=function(){UserService.getContacts().then(function(t){a.the_contacts=t.contacts},function(t){})},a.addContact=function(){UserService.addContact(a.params.contact).then(function(t){a.the_contacts.push(t.contact)},function(t){})},a.purchase=function(){c.purchase(a.chosen_card.id,a.chosen_contact.id).then(function(t){a.step=3},function(t){})}});